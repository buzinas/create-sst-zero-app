services:
  postgres:
    image: postgres:17
    ports:
      - '5432:5432'
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: zero_app
    command: ['postgres', '-c', 'wal_level=logical']
    volumes:
      - postgres_data:/var/lib/postgresql/data

  zero-cache:
    image: rocicorp/zero:latest
    ports:
      - '4848:4848'
    environment:
      ZERO_UPSTREAM_DB: 'postgresql://postgres:postgres@postgres:5432/zero_app'
      ZERO_QUERY_URL: 'http://host.docker.internal:3001/api/zero/query'
      ZERO_MUTATE_URL: 'http://host.docker.internal:3001/api/zero/mutate'
      ZERO_REPLICA_FILE: '/tmp/zero.db'
      ZERO_LOG_LEVEL: 'info'
      NODE_ENV: 'development'
    depends_on:
      - postgres

volumes:
  postgres_data:
